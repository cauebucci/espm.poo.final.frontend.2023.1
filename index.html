<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
    <script type="text/javascript" charset="utf-8" src="public/lib/jquery/jquery.min.js"></script>
    <script type="text/javascript" charset="utf-8" src="public/lib/jquery-mask/jquery-mask-1.14.16.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <link rel="stylesheet" href="public/css/style.css">
    <title>Document</title>
</head>

<body>
    <div class="wrapper">
        <div class="ipad">
            <div class="camera"></div>
            <div class="screen">
                <!-- Put screen stuff in here -->
                <div class="text" id="tela">
                    
                </div>
            </div>
            <div class="button">
                <button class="square" type="button" onclick="telaInicial()"></button>
            </div>
        </div>
    </div>
    <script type="text/javascript">
        var tela = document.getElementById("tela");
        telaInicial();
        async function telaInicial() {
            tela.innerHTML = `
                <div>
                        <img src="public/img/logo.png" width="95%">
                    </div>
                    <div>
                        <button style="width: 50%; max-width: 95%; margin-bottom: 10px; background-color: #ff8507; border-bottom: #ff8507; color: white;" class="btn btn-danger" type="button" onclick="telaEntrar()">Entrar</button>
                        <button style="width: 50%; max-width: 95%; margin-bottom: 10px; background-color: #ff8507; border-bottom: #ff8507; color: white;" class="btn btn-danger" type="button" onclick="telaCadastro()">Primeira vez</button>
                    </div>
                    <p style="margin-top: 8%;">
                        <small>Mesa 21</small>
                    </p>
                </div>
            `
        }
        async function telaEntrar() {
            tela.innerHTML = `
                <div>
                    <img src="public/img/logo.png" width="30%">
                </div>
                <div>
                    <h1 style="margin-bottom: 45%;">Seja bem-vindo(a)</h1>
                </div>
                <div class="row">
                    <div class="col-sm-2">
                    </div>
                    <div class="col-sm-8">
                        <div class="form-group">
                            <label style="text-align: right;" for="cpf">Qual o seu CPF?</label>
                            <input id="cpf" name="cpf" maxlength="85" class="form-control" type="text" spellcheck="false" value=""   style="text-align: center;"/>
                            <p class="cadastro-error" id="error-cpf"></p>

                        </div>
                    </div>
                    <div class="col-sm-2">
                    </div>
                </div>
                <div>
                    <button style="width: 50%; max-width: 95%; margin-bottom: 10px; background-color: #ff8507; border-bottom: #ff8507; color: white;" class="btn btn-danger" type="button" onclick="proximo()">Próximo</button>
                    <button style="width: 50%; max-width: 95%; margin-bottom: 10px; color: white;" class="btn btn-danger" type="button" onclick="telaInicial()">Voltar</button>

                </div>
                
            
            `
            $('#cpf').mask("000.000.000-00", {reverse: true});
        }

        async function telaPrincipal(nome) {
            tela.innerHTML = `
                <div>
                    <img src="public/img/logo.png" width="30%">
                </div>
                <div>
                    <h1 style="margin-bottom: 45%;">Seja bem-vindo(a), <br> ${nome}</h1>
                </div>
                
                
            
            `
            $('#cpf').mask("000.000.000-00", {reverse: true});
        }

        async function telaCadastro() {
            tela.innerHTML = `
                <div>
                    <img src="public/img/logo.png" width="30%">
                </div>
                <div>
                    <h1 style="margin-bottom: 10%;">Cadastro</h1>
                </div>
                <div class="row">
                    <div class="col-sm-2">
                    </div>
                    <div class="col-sm-8">
                        <div class="form-group">
                            <label style="text-align: right;" for="cpf">Qual o seu CPF?</label>
                            <input id="cpf" name="cpf" maxlength="85" class="form-control" type="text" spellcheck="false" value=""   style="text-align: center;"/>
                            <p class="cadastro-error" id="error-cpf"></p>

                        </div>
                        <div class="form-group">
                            <label style="text-align: right;" for="nome">Qual o seu nome?</label>
                            <input id="nome" name="nome" maxlength="85" class="form-control" type="text" spellcheck="false" value=""   style="text-align: center;"/>
                            <p class="cadastro-error" id="error-nome"></p>

                        </div>
                        <div class="form-group">
                                <label style="text-align: right;" for="numero">Qual o seu número?</label>
                                <input id="numero" name="numero" maxlength="85" class="form-control" type="text" spellcheck="false" value=""   style="text-align: center;"/>
                                <p class="cadastro-error" id="error-numero"></p>
                        </div>
                    </div>    
                    <div class="col-sm-2">
                    </div>
                </div>
                <div>
                    <button style="width: 50%; max-width: 95%; margin-bottom: 10px; margin-top: 10px; background-color: #ff8507; border-bottom: #ff8507; color: white;" class="btn btn-danger" type="button" onclick="cadastrar()">Cadastrar</button>
                    <button style="width: 50%; max-width: 95%; margin-bottom: 10px; color: white;" class="btn btn-danger" type="button" onclick="telaInicial()">Voltar</button>

                </div>
                
            
            `
            $('#cpf').mask("000.000.000-00");
            $('#numero').mask("+00 (00) 00000-0000");
        }

        async function proximo() {
            let cpf = document.getElementById("cpf").value;
            if(cpf == "") {
                document.getElementById("error-cpf").innerHTML = "Campo obrigatório!"
                return;
            }

            let cliente = await buscar(cpf);

            if(cliente == null) {
                document.getElementById("error-cpf").innerHTML = "CPF não cadastrado!"
                return;
            }else {

                await telaPrincipal(cliente.nome);
            }

        }

        async function cadastrar() {
            let cpf = document.getElementById("cpf").value;
            let nome = document.getElementById("nome").value;
            let numero = document.getElementById("numero").value;
            let existe = true;
            
            if(await buscar(cpf) == null) {
                existe = false; 
            }else { 
                existe = true;
            }

            let error = false;
            if(cpf == "") {
                document.getElementById("error-cpf").innerHTML = "Campo obrigatório!"
                error = true;
            }else if(await existe) {
                document.getElementById("error-cpf").innerHTML = "CPF já cadastrado!"
                error = true;
            }else {
                document.getElementById("error-cpf").innerHTML = ""
            }

            if(nome == "") {
                document.getElementById("error-nome").innerHTML = "Campo obrigatório!"
                error = true;
            }else {
                document.getElementById("error-nome").innerHTML = ""

            }

            if(numero == "") {
                document.getElementById("error-numero").innerHTML = "Campo obrigatório!"
                error = true;
            }else {
                document.getElementById("error-numero").innerHTML = ""
            }

            if(error) {
                return;
            }

            let dados = {
            cpf: cpf,
            nome: nome,
            numero: numero,
        }

        let opcoes = {
			method: "POST",
			headers: {
				"Content-Type": "application/json"
		    },
		    body: JSON.stringify(dados)
		};
        

        try{
            let response = await fetch("http://localhost:8080/cliente/cadastrar", opcoes);

            if(response.ok){
                telaPrincipal(nome);
                        

            }else{
                
            }

            } catch(ex){
                
            }
        }

        async function buscar(cpf) {
            try{
                let response = await fetch("http://localhost:8080/cliente/buscar/" + cpf);

                if(response.ok){
                    let dados = await response.json();
                    if(dados.cpf == null) {
                        console.log("Nao encontrado")
                        return null;
                    }else {
                        console.log(dados)
                        return dados;
                    }
                }else{
                    
                }

            } catch(ex){
                
            }
        }


    </script>
</body>

</html>